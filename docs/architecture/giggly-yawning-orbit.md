# Plan: Update Architecture Docs

## Context

The architecture docs (`platform-architecture.md` and `flowforge-integration.md`) were last updated on 2026-02-13 (v3.1). Since then, the "Obsidian import flow" feature was added along with Claude Code GitHub App integration, new utility modules, store changes, and a reworked home screen. The docs need to reflect the current codebase state.

---

## File 1: `docs/architecture/flowforge-integration.md`

This file has the most significant gaps. Changes by section:

### Section 1 — FlowForge's Role

- Update "Current state" paragraph to mention the dual-flow home screen (Obsidian import + manual create)
- Update "Next" list: Obsidian import is done; remaining items are full workflow/stack selection UI for manual flow (replacing hardcoded Web App / CLI Tool) and project dashboard

### New Section (insert after Section 2, before current Section 3) — Obsidian Import Flow

- Describe the end-to-end flow: pick .md file → parse frontmatter → review/edit settings → create repo with context file
- Cover `lib/frontmatter.ts`: `parseFrontmatter()` (extracts workflow, stack, isPrivate, description from YAML block), `filenameToRepoName()` (auto-derives repo name)
- Cover `PickedFile` and `FrontmatterResult` types from `lib/types.ts`
- Cover context file injection in `createRepository()`: stored at `context/{filename}`, CLAUDE.md gets `## Project Context` section appended with `@context/filename` reference
- Cover the frontmatter format users can put in their .md files:
  ```yaml
  ---
  workflow: research
  stack: python
  private: true
  description: My project description
  ---
  ```
- Note file constraints: .md only, max 500KB

### New Section (insert near Claude Code App) — Claude Code GitHub App Integration

- Describe `lib/claude-code-app.ts`: `setupClaudeCode()`, `findClaudeCodeInstallation()`, `enableClaudeCodeForRepo()`
- After repo creation, FlowForge attempts to add the repo to the user's Claude Code GitHub App installation (non-blocking)
- Success screen shows status: enabled / not installed (with install link) / error

### Section 8 — Mobile UX Flow

- Update intro: remove "designed but not yet built" — the Obsidian import flow IS built
- Update home screen description: two primary buttons ("Import from Obsidian" → `/pick`, "Create Manually" → `/create`)
- Note that manual flow still uses hardcoded templates (Web App = greenfield--typescript-react, CLI Tool = greenfield--typescript-node)
- The planned 5-screen workflow/stack selection replaces the manual flow, not the Obsidian flow
- Fix `handleCreate()` code example: `buildSettings` is called internally by `composeTemplate`, not separately

### Section 8 addendum — Success Screen

- Update to reflect current implementation: Claude Code GitHub App status card, "Open Claude Code" button (opens claude.ai/code), "Create Another Project" button, copy-to-clipboard clone command
- Note: success screen does NOT yet show workflow-specific next-steps (Section 11's design is still future)

### Section 12 — Implementation Sequence

- Mark completed Sprint 4 items: #13 (template composition), #15 (devcontainer composition)
- Add new completed items: Obsidian import flow, frontmatter parsing, Claude Code GitHub App integration, dual-flow home screen
- Note that #14 (workflow/stack selection UI) is partially done — Obsidian import bypasses it via frontmatter, manual flow still needs it
- Note that #16 (success screen per workflow) and #17 (dashboard) are still future

### Store & Types Updates (weave into relevant sections)

- `CreateRepoOptions` now includes `contextFile?: { filename: string; content: string }`
- `CreatedRepo` now includes `id?: number`
- New types: `PickedFile`, `FrontmatterResult`, `WorkflowMeta`, `StackMeta`
- Store additions: `claudeCodeEnabled`, `claudeCodeError`, `recentRepos`, `resetCreationState()`, `setClaudeCodeState()`, `addRecentRepo()`

### Cross-References

- Add `lib/frontmatter.ts`, `lib/claude-code-app.ts`, `components/CopyableError.tsx`

### Version/Date

- Bump to v3.2, date 2026-02-15

---

## File 2: `docs/architecture/platform-architecture.md`

This doc is a design reference for the platform layer. It's largely accurate — the template system implements what's described. Minor updates:

### Version/Date

- Bump to v3.2, date 2026-02-15

### Section 5.9 — Context Budget Monitor

- Add note: this prompt-type Stop hook is described as part of the platform design but is NOT currently generated by the template system (`settings.ts`). It would need to be added to `buildSettings()` or configured globally. Currently only `stop-test-loop.sh` is wired to the Stop event in generated repos.

### Section 5 intro or summary table

- Add a quick-reference table clarifying which hooks are template-generated (10 scripts via `platform.ts`) vs. globally-installed (RTK auto-wrapper) vs. not yet implemented in templates (context budget monitor)

---

## Files to Modify

1. `docs/architecture/flowforge-integration.md` — major updates (new sections, revised sections)
2. `docs/architecture/platform-architecture.md` — minor updates (version, clarification notes)

## Key Source Files Referenced

- `flowforge-mobile/lib/github.ts` — createRepository with contextFile injection
- `flowforge-mobile/lib/types.ts` — all type definitions
- `flowforge-mobile/lib/frontmatter.ts` — frontmatter parsing + filenameToRepoName
- `flowforge-mobile/lib/claude-code-app.ts` — GitHub App integration
- `flowforge-mobile/stores/store.ts` — Zustand store shape
- `flowforge-mobile/app/(app)/index.tsx` — dual-flow home screen
- `flowforge-mobile/app/(app)/pick.tsx` — Obsidian import flow
- `flowforge-mobile/app/(app)/success.tsx` — success screen with Claude Code status
- `flowforge-mobile/lib/templates/compose.ts` — composeTemplate (includes settings internally)

## Verification

- After editing, read both docs end-to-end to check internal consistency
- Verify cross-references between the two docs are correct
- Verify section numbering is sequential after insertions
- Spot-check code examples against actual source files
